(function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),r=n&&e.Uint8Array&&function(){try{return(new Blob([new Uint8Array(100)])).size===100}catch(e){return!1}}(),i=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,s=(n||i)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,s,o,u,a,f;e.split(",")[0].indexOf("base64")>=0?t=atob(e.split(",")[1]):t=decodeURIComponent(e.split(",")[1]),s=new ArrayBuffer(t.length),o=new Uint8Array(s);for(u=0;u<t.length;u+=1)o[u]=t.charCodeAt(u);return a=e.split(",")[0].split(":")[1].split(";")[0],n?new Blob([r?o:s],{type:a}):(f=new i,f.append(s),f.getBlob(a))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,n,r){r&&t.toDataURL&&s?e(s(this.toDataURL(n,r))):e(this.mozGetAsFile("blob",n))}:t.toDataURL&&s&&(t.toBlob=function(e,t,n){e(s(this.toDataURL(t,n)))})),typeof define=="function"&&define.amd?define(function(){return s}):e.dataURLtoBlob=s})(this),function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),r=n&&e.Uint8Array&&function(){try{return(new Blob([new Uint8Array(100)])).size===100}catch(e){return!1}}(),i=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,s=(n||i)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,s,o,u,a,f;e.split(",")[0].indexOf("base64")>=0?t=atob(e.split(",")[1]):t=decodeURIComponent(e.split(",")[1]),s=new ArrayBuffer(t.length),o=new Uint8Array(s);for(u=0;u<t.length;u+=1)o[u]=t.charCodeAt(u);return a=e.split(",")[0].split(":")[1].split(";")[0],n?new Blob([r?o:s],{type:a}):(f=new i,f.append(s),f.getBlob(a))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,n,r){r&&t.toDataURL&&s?e(s(this.toDataURL(n,r))):e(this.mozGetAsFile("blob",n))}:t.toDataURL&&s&&(t.toBlob=function(e,t,n){e(s(this.toDataURL(t,n)))})),typeof define=="function"&&define.amd?define(function(){return s}):e.dataURLtoBlob=s}(this);var ImagePicker=function(){var e=new FileReader,t,n,r,i,s,o=0,u,a,f=function(e){r=new Image,r.onload=function(){n&&n()},r.src=e},l=function(){s.clearRect(0,0,i.width,i.height)},c=function(){switch(o){case 0:d();break;case 1:v();break;case 2:m();break;case 3:g()}},h=function(e){r.naturalWidth>r.naturalHeight&&r.naturalWidth>e?(u=e,a=Math.round(u*(r.naturalHeight/r.naturalWidth))):r.naturalHeight>e?(a=e,u=Math.round(a*(r.naturalWidth/r.naturalHeight))):(u=r.naturalWidth,a=r.naturalHeight)},p=function(e,t){u=e,a=t},d=function(){i.width=u,i.height=a,s.drawImage(r,0,0,r.naturalWidth,r.naturalHeight,0,0,u,a)},v=function(){i.width=a,i.height=u,s.save(),s.translate(a/2,u/2),s.rotate(Math.PI/2),s.drawImage(r,0,0,r.naturalWidth,r.naturalHeight,-u/2,-a/2,u,a),s.restore()},m=function(){i.width=u,i.height=a,s.save(),s.translate(u/2,a/2),s.rotate(Math.PI),s.drawImage(r,0,0,r.naturalWidth,r.naturalHeight,-u/2,-a/2,u,a),s.restore()},g=function(){i.width=a,i.height=u,s.save(),s.translate(a/2,u/2),s.rotate(-Math.PI/2),s.drawImage(r,0,0,r.naturalWidth,r.naturalHeight,-u/2,-a/2,u,a),s.restore()},y=function(){e.onloadend=function(e){f(e.target.result)},e.readAsDataURL(t.files[0])};return $(document).ready(function(){t=document.createElement("input"),t.type="file",t.accept="image/*",t.style.display="none",t.addEventListener("change",function(e){setTimeout(y,0)},!1),document.body.appendChild(t),i=document.createElement("canvas"),s=i.getContext("2d")}),{pick:function(e){n=e,$(t).trigger("click")},canvas:function(){return i},render:c,skew:p,setMaxEdge:h,rotateCW:function(){o=(o+1)%4,c()},rotateCCW:function(){o--,o<0&&(o=3),c()}}}();